
<html>
    <head>
        <meta charset="utf-8">
        <style>
        html,
        body,
        #container {
            width: 100%;
            height: 100%;
            }
        #transfer-panel {
            position: absolute;
            background-color: white;
            max-height: 80%;
            overflow-y: auto;
            top: 30px;
            left: 20px;
            width: 250px;
        }
        .control-input {
            margin-left: 120px;
        }

        .control-input input[type="text"] {
            width: 160px;
        }
        .control-panel {
            position: absolute;
            top: 30px;
            right: 20px;
        }
        </style>
       
    
    </head>
    <body>
        <div id="container"></div> 
        <div id="transfer-panel"></div>
        <div class="control-panel">
            <label>选择工作地点：</label>
            <div class="control-input">
                <input id="work-location" type="text">
            </div>
        </div>
<!---------------------------------加载地图API------------------------------------------------------------>

        <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.13&key=c09c4ec1d247fab72b361795b999bb85&plugin=AMap.ElasticMarker,AMap.ToolBar,AMap.Scale,AMap.AdvancedInfoWindow,AMap.Autocomplete,AMap.Transfer,AMap.ArrivalRange,AMap.Geocoder,AMap.CitySearch,AMap.Geolocation"></script> 
        <script type="text/javascript">
            var AMapUIProtocol = 'https:';  //注意结尾包括冒号
            </script>
            <!-- https 方式引入入口文件 -->
            <script src="https://webapi.amap.com/ui/1.0/main.js"></script>
        <script>

        var map = new AMap.Map('container', {
        resizeEnable: true, //是否监控地图容器尺寸变化
        zoom:11, //初始化地图层级
        
        
    
        });
    // 在图面添加工具条控件，工具条控件集成了缩放、平移、定位等功能按钮在内的组合控件
    map.addControl(new AMap.ToolBar({
        liteStyle:true
    }));

    
    map.addControl(new AMap.Scale());
   // 在图面添加比例尺控件，展示地图在当前层级和纬度下的比例尺
    
    // 在图面添加定位控件，用来获取和展示用户主机所在的经纬度位置
    map.addControl(new AMap.Geolocation());


//定义全区变量---------------------------------------------------------------------------------------------
    //公交到达圈对象
    var arrivalRange = new AMap.ArrivalRange();
    //经度，纬度，时间，通勤方式
    var x,y,t,vehicle="SUBWAY,BUS"
    //工作地点，工作地点标记
    var workAddress,workMarker;
    //房源标记队列
    var rentMarkerArray=[]
    //多边形队列，储存公交到达的计算结果
    var polygonArray=[]
    //路径规划
    var amapTransfer;
    var positionPicker











//模块----------------------------------------------   

//信息窗口，展示房源信息
var infoWindow=new AMap.InfoWindow({
    offset:new AMap.Pixel(0,-30)
});
//自动补全工作地点
// var auto = new AMap.Autocomplete({
//     input: "work-location"
// });
var autoOptions = {
        input: "work-location"
    };
var auto = new AMap.Autocomplete(autoOptions);
//函数----------------------------------------------     

//删除工作地址
function delWorkLocation(){
    if(polygonArray) map.remove(polygonArray);
    // if(workMarker) map.remove(workMarker);
    polygonArray=[];
}





//加载工作地址
function loadWorkLocation() {
    delWorkLocation();
    var geocoder = new AMap.Geocoder({
        city: "北京",
        radius: 1000
    });

    geocoder.getLocation(workAddress, function(status, result) {
        if (status === "complete" && result.info === 'OK') {
            var geocode = result.geocodes[0];
            x = geocode.location.getLng();
            y = geocode.location.getLat();
            loadWorkMarker(x, y);
            loadWorkRange(x, y, 60, "#3f67a5", vehicle);
            map.setZoomAndCenter(12, [x, y]);
        }
    })
}







//加载工作地周围的公交到达圈
function loadWorkRange(workAddress, t, color, v) {
    arrivalRange.search(workAddress, t, function(status, result) {
        if (result.bounds) {
            for (var i = 0; i < result.bounds.length; i++) {
                var polygon = new AMap.Polygon({
                    map: map,
                    fillColor: color,
                    fillOpacity: "0.4",
                    strokeColor: color,
                    strokeOpacity: "0.8",
                    strokeWeight: 1
                });
                polygon.setPath(result.bounds[i]);
                polygonArray.push(polygon);
            }
            // map.add(polygonArray);
            map.setFitView();
        }
    }, {
        policy: v
    });
}
  
  
  
  
  
  
  
function onClick(e) {
    map.remove(polygonArray);
   positionPicker.start(e.lnglat);
};
map.on('click', onClick);

  
  
  
  
  
    AMapUI.loadUI(['misc/PositionPicker'], function(PositionPicker) {
      positionPicker = new PositionPicker({
        mode:'dragMarker',//设定为拖拽地图模式，可选'dragMap'、'dragMarker'，默认为'dragMap'
        map:map//依赖地图对象
    });
    //TODO:事件绑定、结果处理等
    positionPicker.on('success',function(positionResult){
        workAddress=positionResult.position;
        delWorkLocation();
        loadWorkRange(workAddress, 60, "#3f67a5", vehicle)
        
    });
    positionPicker.start();
});



       // map.setCity('郑州')
        </script>
    </body>
</html>
